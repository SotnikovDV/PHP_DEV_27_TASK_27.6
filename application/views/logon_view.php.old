<?php
$errors = [];
$remember = false;

if (isset($_COOKIE['remember'])) {
    $remember = $_COOKIE['remember'];
}

if (isset($_POST['submit'])) {
    $login = $_POST['login'];
    $password = $_POST['password'];
    $remember = isset($_POST['remember']);
    // если пользователь не хочет, что бы его запоминали
    if (!$remember) {
        setcookie("remember", false, time() - 3600 * 24 * 30 * 12, "/");
    } else {
        setcookie("remember", true, time() + 60 * 60 * 24 * 30, "/");
    }

    //echo $login.'<br>';
    //echo $password.'<br>';

    $usr = $user->logon($login, $password, $remember);

//var_dump($usr);

    if (!$usr) {
        //header("Location: logon?error=1");
        $errors = $user->lastErrors;
    } else {
        header("Location: /");
        //exit();        
    }
}
?>
<div class="input-box login-box">
    <div class="login-box-title">Вход</div>
    <?php
    //if (key_exists('error', $_REQUEST)) {
        if ($errors) {
    ?>
        <div class="login-box-error">Авторизация не удалась из-за следующих проблем:<br><br>
            <p class="login-box-note"><?php foreach ($errors as $error) { echo $error.'<br>'; } ?></p>
            </div>
    <?php
    } else {
    ?>
        <div class="login-box-note">Или <a href="register">зарегиструйтесь</a>, если вы не пользователь галереи</div>
    <?php
    }
    ?>
    <form action="logon" method="post" class="login-form">
        <label for="login">Имя пользователя:</label>
        <input name="login" type="text" placeholder="..." class="inpt" required autofocus>
        <label for="password">Пароль:</label>
        <input name="password" type="password" placeholder="..." class="inpt" required>
        <!-- <span></span><div style="margin: 0; font-size: smaller;"><input class="inpt" type="checkbox" onclick="showPassword('password');">  Показать пароль</div> -->
        <span></span><div style="margin: 0; font-size: smaller;"><input name="remember" class="inpt" type="checkbox" <?php if ($remember) { echo 'checked'; } ?> >  Запомнить меня</div>
        <input name="submit" type="submit" value="Войти" class="btn">
        <input name="button" type="button" value="Отмена" onclick="location='/'" class="btn">
    </form>
</div>